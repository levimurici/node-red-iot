"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.subscribeEntityRegistry = exports.subscribeDeviceRegistry = exports.subscribeAreaRegistry = void 0;
const home_assistant_js_websocket_1 = require("home-assistant-js-websocket");
function subscribeAreaRegistry(conn, cb) {
    const fetchAreaRegistry = (conn) => conn.sendMessagePromise({
        type: 'config/area_registry/list',
    });
    const subscribeUpdates = (conn, store) => conn.subscribeEvents(async () => {
        const areas = await fetchAreaRegistry(conn);
        store.setState(areas, true);
    }, 'area_registry_updated');
    const collection = (0, home_assistant_js_websocket_1.getCollection)(conn, '_areas', fetchAreaRegistry, subscribeUpdates);
    collection.subscribe(cb);
}
exports.subscribeAreaRegistry = subscribeAreaRegistry;
function subscribeDeviceRegistry(conn, cb) {
    const fetchDeviceRegistry = (conn) => conn.sendMessagePromise({
        type: 'config/device_registry/list',
    });
    const subscribeUpdates = (conn, store) => conn.subscribeEvents(async () => {
        const devices = await fetchDeviceRegistry(conn);
        store.setState(devices, true);
    }, 'device_registry_updated');
    const collection = (0, home_assistant_js_websocket_1.getCollection)(conn, '_devices', fetchDeviceRegistry, subscribeUpdates);
    collection.subscribe(cb);
}
exports.subscribeDeviceRegistry = subscribeDeviceRegistry;
function subscribeEntityRegistry(conn, cb) {
    const fetchEntityRegistry = (conn) => conn.sendMessagePromise({
        type: 'config/entity_registry/list',
    });
    const subscribeUpdates = (conn, store) => conn.subscribeEvents(async () => {
        const devices = await fetchEntityRegistry(conn);
        store.setState(devices, true);
    }, 'entity_registry_updated');
    const collection = (0, home_assistant_js_websocket_1.getCollection)(conn, '_entity', fetchEntityRegistry, subscribeUpdates);
    collection.subscribe(cb);
}
exports.subscribeEntityRegistry = subscribeEntityRegistry;
